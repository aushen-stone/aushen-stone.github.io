# Worklog - 2026-02-05

## Summary
This session connected the Aushen product library CSV to the frontend with a durable data model, a build script that generates typed data, and UI updates for products list and detail pages. We also fixed a blocking issue where product detail pages always showed "Stone not found," and upgraded the detail UX to be application-first (application -> finish -> sizes).

## Key Decisions
- Product is modeled at "Product Name" level, with finish + slip rating as variants.
- Application comes before finish in the detail UX (customer-first flow).
- Application and material categories are derived from CSV and generated into TypeScript.
- Product images use a single placeholder by default; overrides allow future mapping.
- Color tone is a manual override (not present in CSV).

## Implemented Changes
- Added shared types for product data in `src/types/product.ts`.
- Added `scripts/build-product-data.ts` to parse CSV and generate:
  - `src/data/products.generated.ts`
  - `src/data/categories.generated.ts`
- Added `src/data/product_overrides.ts` with placeholder image and optional tone/description overrides.
- Updated `src/app/products/page.tsx` to:
  - Use generated product data.
  - Support filters for material, application, and tone.
  - Use placeholder images.
- Updated `src/app/products/[slug]/page.tsx` to:
  - Use `useParams()` for slug (fixed "Stone not found").
  - Use application-first selection (application -> finish -> sizes).
  - Show sizes for the selected application+finish.
  - Show derived subtitle and tech specs.
- Updated `src/app/components/Navbar.tsx` and `src/app/components/ProductSidebar.tsx` to consume generated categories.

## Data Model (Current)
- Product
  - materialId, materialName
  - finishes: FinishVariant[]
  - applicationIndex: ApplicationIndexEntry[] (application-first index)
  - media (product photo status and application photo progress)
- FinishVariant
  - slipRating, applications (each with sizes)
- ApplicationIndexEntry
  - application label + finishes, each with sizes

## How to Regenerate Data
From `aushen-web/`:
```bash
npx tsc --target ES2019 --module commonjs --esModuleInterop --outDir /tmp/aushen-scripts scripts/build-product-data.ts
node /tmp/aushen-scripts/build-product-data.js
```

## Observations
- CSV produces 62 products and 87 finish variants, 10 materials.
- All products have at least one application and size.

## Known Issues / Follow-ups
- `npm run lint` reports existing errors across the app unrelated to the product work (unescaped entities, HTML links, setState in effects, explicit any, etc.). These were not addressed in this session.
- Optional: add a convenience npm script for the data build step.

---

## Update - 2026-02-05 (Product UX + Structure Pass)

### Summary
Implemented the planned product-first improvements: mobile filter usability, product detail readability updates, audience-specific content flow, and structural navbar deduplication.

### Implemented Changes
- Global structure:
  - Kept navbar in `src/app/layout.tsx` only.
  - Removed duplicated `<Navbar />` usage from page files.
  - Changed `src/app/components/PageOffset.tsx` wrapper from `<main>` to `<div>` to avoid nested `main` landmarks.
- Product list (`src/app/products/page.tsx`):
  - Added mobile filter drawer (open/close state, overlay close, ESC close, focus loop, body scroll lock).
  - Reused `ProductSidebar` inside drawer.
  - Added accessibility attributes and focus-visible states for filter controls.
- Product filter component (`src/app/components/ProductSidebar.tsx`):
  - Added `className`, `sticky`, and `idPrefix` props for reuse in desktop + mobile contexts.
  - Added `aria-expanded`, `aria-controls`, checkbox labels, and focus states.
- Product detail (`src/app/products/[slug]/page.tsx`):
  - Removed duplicated navbar usage.
  - Increased right-panel typography hierarchy:
    - Section labels to 12px.
    - Selector options to 13px with min 40px height.
    - Size pills to 12px with larger vertical padding.
    - Spec keys to 12px.
  - Added `Audience Toggle` (`Homeowner` / `Professional`) and mode-specific summary + bullet guidance.
  - Implemented CTA priority by audience:
    - Homeowner: Sample -> Consultation/Enquire.
    - Professional: Enquire -> Call/Sample.
- Product data contracts:
  - Extended `src/types/product.ts` with `AudienceMode` and new optional override fields.
  - Added default homeowner/professional copy constants in `src/data/product_overrides.ts`.

### Validation
- Lint on changed scope now has **0 errors** (warnings remain primarily `@next/next/no-img-element` in non-product pages that still use `<img>` intentionally).
